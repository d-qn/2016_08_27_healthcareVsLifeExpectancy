---
title: ""
author: "Duc-Quang Nguyen | swissinfo.ch"
date: " 2016"
output: 
  html_document:
    toc: true
    toc_depth: 3
    theme: simplex
---


## Data

* Population from [stat-tab](https://www.pxweb.bfs.admin.ch/Table.aspx?layout=tableViewLayout2&px_tableid=px-x-0102010000_102%5cpx-x-0102010000_102.px&px_language=fr&px_type=PX&px_db=px-x-0102010000_102&rxid=c52f847b-3e18-4f95-be22-520dd3a44e44)
* Primes moyenne par canton [OFSP](http://www.bag.admin.ch/themen/krankenversicherung/00261/15006/index.html?lang=fr), pdf [Assurance-maladie - Primes 2014](http://www.bag.admin.ch/themen/krankenversicherung/00261/15006/index.html?lang=fr&download=NHzLpZeg7t,lnp6I0NTU042l2Z6ln1ae2IZn4Z2qZpnO2Yuq2Z6gpJCLeX54f2ym162epYbg2c_JjKbNoKSn6A--)
  * tabulized!

```{r setup, include=FALSE}

mergedCantonalBudget <- T

health.code <- as.character(c(41, 42, 43, 48, 49, 51))
path.cantonalMuni.buget <- "data/fs_ktn_gdn/ktn_gdn_vgl.xlsx"

path.cantonalPop <- "data/px-x-0102010000_102.csv"
path.prime2014 <- "data/Prime_moyenneCanton_2014_tabula-f-3.csv"
#path.lifeExpectancy <- 


library(readr)
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(scales)
library(swiMap)
library(swiTheme)
library(forcats)

### Getting data in packages
library(readxl)


### Interactive 
library(htmltools)
library(shiny)
library(swiRcharts)
library(rCharts)
```

```{r get cantonal health data}
b.read <- read_excel(path.cantonalMuni.buget, sheet = "ausgaben_funk", skip = 6)
# rename colnames
colnames(b.read)[1] <- 'id'
colnames(b.read)[2] <- 'fonction'
colnames(b.read) <- gsub("Canton (des |d\\'|du |de )(.*) et ses communes", "\\2", colnames(b.read))
colnames(b.read)
colnames(b.read)[-(1:2)] <- canton_namesStrict(colnames(b.read)[-(1:2)], "iso2")

# get only health spending by cantons
hs <- b.read %>% filter(id %in% health.code) %>% select(-fonction, -id)
hs <- as.data.frame(colSums(hs, na.rm = T))
hs$Canton <- rownames(hs)
hs %<>% rename(health = `colSums(hs, na.rm = T)`)
```

```{r cantonal pop load and average premiums}
pop <- read.table(path.cantonalPop, skip = 1, sep = "\t", header = T, check.names = F, encoding = "latin1")
pop %<>% select(-Ann√©e, -`Type de population`, -`Sexe`, -`Etat civil`)

pop$Canton <- canton_CH %>% arrange(order) %>% select(iso2) %>% unlist() %>% as.character()
pop %<>% rename(pop = `Age - Total`)

prem <- read.csv(path.prime2014, header = F, stringsAsFactors = F)[,c(1, 3)]
colnames(prem) <- c('Canton', 'prime')
```

```{r combine all data}
data <- left_join(pop, hs)
data$healthSpendingByCapita <- data$health / data$pop
data <- left_join(data, prem)

ggplot(data = data) + geom_point(aes(x = healthSpendingByCapita, y = prime, group=Canton, size = pop))


```
